<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TaskHub</title>

<style>
body{
 font-family:Arial;
 background:#0f172a;
 color:white;
 text-align:center;
 overflow-x:hidden;
}

.box{
 background:#1e293b;
 padding:25px;
 margin:30px auto;
 width:360px;
 border-radius:14px;
 box-shadow:0 0 25px #0006;
}

.hello{
 font-size:22px;
 font-weight:bold;
 background:linear-gradient(90deg,#22c55e,#38bdf8);
 -webkit-background-clip:text;
 color:transparent;
}

button{
 padding:10px;
 margin:6px;
 border:none;
 border-radius:8px;
 background:#22c55e;
 color:white;
 cursor:pointer;
 font-weight:bold;
}

button:hover{transform:scale(1.05)}

.logout{background:#ef4444;}
.musicBtn{background:#38bdf8;}

input{
 padding:10px;
 margin:6px;
 width:90%;
 border-radius:6px;
 border:none;
}

#withdrawBox,#welcomeBox{
 position:fixed;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(0,0,0,.7);
 display:none;
 justify-content:center;
 align-items:center;
 z-index:9999;
}

.popup{
 background:#1e293b;
 padding:25px;
 border-radius:12px;
 width:340px;
}

.adminUser{
 background:#0f172a;
 margin:8px;
 padding:10px;
 border-radius:8px;
}

.petal{
 position:fixed;
 top:-50px;
 animation:fall linear forwards;
}

@keyframes fall{
 100%{transform:translateY(110vh) rotate(360deg)}
}
</style>
</head>

<body>

<h1>ğŸ’° TaskHub</h1>

<audio id="bgMusic" loop>
<source src="music.mp3" type="audio/mpeg">
</audio>

<!-- LOGIN -->
<div id="auth" class="box">
<h3>ÄÄƒng kÃ½ / ÄÄƒng nháº­p</h3>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password"><br>
<button onclick="register()">ÄÄƒng kÃ½</button>
<button onclick="login()">ÄÄƒng nháº­p</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="box" style="display:none">
<div class="hello">
ğŸ‘‹ Xin chÃ o <span id="name"></span>
</div>

<p>Sá»‘ dÆ°: <b id="money">0</b>Ä‘</p>

<button onclick="taoTask()">ğŸ§© LÃ m nhiá»‡m vá»¥ (+200Ä‘)</button>
<button onclick="rutTien()">ğŸ’¸ RÃºt tiá»n</button>
<button onclick="toggleMusic()" class="musicBtn">ğŸµ Nháº¡c</button>
<button class="logout" onclick="logout()">ÄÄƒng xuáº¥t</button>

<p id="status"></p>
</div>

<!-- ADMIN -->
<div id="adminPanel" class="box" style="display:none">
<h3>ğŸ›  ADMIN PANEL</h3>
<div id="userList"></div>
</div>

<!-- POPUP -->
<div id="withdrawBox">
<div class="popup">
<h3>ğŸ’¸ RÃºt tiá»n</h3>
<button onclick="openFB()">ğŸ“© IB Admin</button><br><br>
<button onclick="closeWithdraw()">ÄÃ³ng</button>
</div>
</div>

<div id="welcomeBox">
<div class="popup">
<h3 style="color:#22c55e">ğŸ‰ CHÃ€O Má»ªNG ğŸ‰</h3>
<p>Welcome to <b>TaskHub</b></p>
<button onclick="closeWelcome()">Báº¯t Ä‘áº§u ğŸš€</button>
</div>
</div>

<script>

/* ================= API ================= */

const API="http://localhost:5000";
let currentUser=null;

/* ================= AUTH ================= */

async function register(){

 let res=await fetch(API+"/register",{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({
    user:user.value,
    pass:pass.value
  })
 });

 let data=await res.json();

 if(data.ok) alert("âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng");
 else alert(data.error);
}

async function login(){

 let res=await fetch(API+"/login",{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({
    user:user.value,
    pass:pass.value
  })
 });

 let data=await res.json();

 if(data.error){
  alert(data.error);
  return;
 }

 currentUser=data.user;

 auth.style.display="none";
 dashboard.style.display="block";

 name.innerText=data.user;
 money.innerText=data.money;

 if(data.user==="admin"){
   adminPanel.style.display="block";
   loadAdmin();
 }

 welcomeBox.style.display="flex";
}

function logout(){
 location.reload();
}

function closeWelcome(){
 welcomeBox.style.display="none";
}

/* ================= TASK ================= */

async function taoTask(){

 status.innerText="â³ Äang xá»­ lÃ½...";

 let res=await fetch(API+"/task",{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({user:currentUser})
 });

 let data=await res.json();

 money.innerText=data.money;
 status.innerText="âœ… +200Ä‘ thÃ nh cÃ´ng!";
}

/* ================= ADMIN ================= */

async function loadAdmin(){

 let res=await fetch(API+"/admin/users");
 let users=await res.json();

 userList.innerHTML="";

 for(let u in users){

  let div=document.createElement("div");
  div.className="adminUser";

  div.innerHTML=`
   ğŸ‘¤ ${u}<br>
   ğŸ’° <input id="money_${u}" value="${users[u].money}">
   <button onclick="upda
