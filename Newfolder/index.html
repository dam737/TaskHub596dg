<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TaskHub</title>

<style>
body{
font-family:Arial;
background:#0f172a;
color:white;
text-align:center;
}

.box{
background:#1e293b;
padding:25px;
margin:30px auto;
width:360px;
border-radius:14px;
}

button{
padding:10px;
margin:6px;
border:none;
border-radius:8px;
background:#22c55e;
color:white;
cursor:pointer;
}

input{
padding:10px;
margin:6px;
width:90%;
border-radius:6px;
border:none;
}

.adminUser{
background:#0f172a;
margin:6px;
padding:10px;
border-radius:8px;
}
</style>
</head>

<body>

<h1>üí∞ TaskHub</h1>

<div id="auth" class="box">
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password"><br>
<button onclick="register()">ƒêƒÉng k√Ω</button>
<button onclick="login()">ƒêƒÉng nh·∫≠p</button>
</div>

<div id="dashboard" class="box" style="display:none">
<p>Xin ch√†o <b id="name"></b></p>
<p>S·ªë d∆∞: <b id="money">0</b>ƒë</p>

<button onclick="taoTask()">üß© L√†m nhi·ªám v·ª•</button>
<button onclick="logout()">ƒêƒÉng xu·∫•t</button>

<p id="status"></p>
</div>

<div id="adminPanel" class="box" style="display:none">
<h3>ADMIN PANEL</h3>
<div id="userList"></div>
</div>

<script>

const API="http://localhost:5000";
let currentUser="";
let isAdmin=false;

/* REGISTER */
async function register(){

let res=await fetch(API+"/register",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
user:user.value,
pass:pass.value
})
});

let d=await res.json();
alert(d.ok?"ƒêƒÉng k√Ω OK":"User t·ªìn t·∫°i");
}

/* LOGIN */
async function login(){

let res=await fetch(API+"/login",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
user:user.value,
pass:pass.value
})
});

let d=await res.json();

if(!d.ok) return alert("Sai t√†i kho·∫£n");

currentUser=user.value;
name.innerText=currentUser;

auth.style.display="none";
dashboard.style.display="block";

if(d.admin){
isAdmin=true;
adminPanel.style.display="block";
loadAdmin();
}else{
money.innerText=d.money;
}
}

/* TASK */
async function taoTask(){

status.innerText="ƒêang t·∫°o nhi·ªám v·ª•...";

let res=await fetch(API+"/create_task",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({user:currentUser})
});

let d=await res.json();

window.open(d.link,"_blank");
}

/* ADMIN LOAD */
async function loadAdmin(){

let res=await fetch(API+"/users");
let users=await res.json();

userList.innerHTML="";

for(let u in users){

let div=document.createElement("div");
div.className="adminUser";

div.innerHTML=`
üë§ ${u}
<input id="m_${u}" value="${users[u].money}">
<button onclick="saveMoney('${u}')">L∆∞u</button>
`;

userList.appendChild(div);
}
}

/* UPDATE MONEY */
async function saveMoney(u){

let value=document.getElementById("m_"+u).value;

await fetch(API+"/update_money",{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
user:u,
money:value
})
});

alert("ƒê√£ c·∫≠p nh·∫≠t");
loadAdmin();
}

function logout(){location.reload();}

</script>
</body>
</html>
